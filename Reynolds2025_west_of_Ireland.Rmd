---
title: "Comparing social needs for transport, gaps in transit service and the Mobility Index for the west of Ireland"
runningheader: "The west of Ireland:transit needs-gaps" # only for pdf output
author: "Dr James Reynolds"
date: "`r Sys.Date()`"
bibliography: References.bib
csl: https://www.zotero.org/styles/chicago-fullnote-bibliography-16th-edition
suppress-bibliography: yes
output:
#  tufte::tufte_html: default
  tufte::tufte_handout:
#    citation_package: natbib
#    latex_engine: xelatex
#  tufte::tufte_book:
#    citation_package: natbib
#    latex_engine: xelatex

---

```{r setup, include=FALSE}
library(tidyverse)
library(tidytransit)
library(sp)
library(strayr)
library(ptinpoly)
library(magrittr)
library(ggplot2)
library(sf)
library(ASGS.foyer)
library(raster)
library(ggmap)
library(units)
library(janitor)
library(mapview)
library(ggstatsplot)
library(gtsummary)
library(moments)
library(scales)
library(gtfstools)
library(lubridate)
library(kableExtra)
library(knitr)
library(readxl)
library(readr)
library(dplyr)
library(devtools)
library(gtfssupplyindex)
library(readabs)
library(gglorenz)
library(DescTools)
library(RColorBrewer)
library(lsr)
library(ggpubr)
library(viridis)
library(geosphere)
library(png)
library(absmapsdata)
library(tidytransit)
library(patchwork)
library(ggmapinset)
library(tufte)
library(gglorenz)
library(ggExtra)
library(ggthemes)
library(geomtextpath)
library(ggrepel)
#library(memisc, warn.conflicts = FALSE, quietly=TRUE)

knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

```

# Introduction

# Research Background
A wide selection of 
indexes, 
metrics 
and other indicators 
have been developed by 
researchers, 
practitioners 
and others 
to assess 
transport 
and related factors. 
Examples include: 
*Walk Score* and *Transit Score*[@WalkScore:2023tg], which rate a location out of 100 for walkability and 
transit accessibility respectively; 
metrics within the *Transit Capacity and Quality of Service Manual (TCQSM)*[@TCQSM:2013]; and
the UK's 
Public Transport Accessibility Level (PTAL) approach
and the Public Transport Accessibility Index (PTAI)[@Saghapour:2016aa]

What may sometimes 
be lacking is 
comparison of 
the results obtained 
using one set of indicators 
versus others.
In part this can be because of the 
variability in data availability. 
For example, 
national censuses often provide a 
key resource for 
understanding transport-related issues, 
yet the collection practices used, 
questions asked and 
other characteristics 
tend to be highly variable from 
one jurisdiction to another. 
As well, 
some indicators 
have been developed for specific contexts, 
for example 
McHenry et al. (2023)[@McHenry:2023aa] 
recently developed 
a Mobility Index (MI) 
for rural centres in the west of Ireland/ 
This differs from other MIs, 
which may tend to be focused on 
urbanised locations.  

Finally, 
some indicators are 
difficult or impossible 
to calculate independently. 
Some are closed-source, 
in that they may be propitiatory
or otherwise only available from a single website^[e.g. WalkScore and Transit Score cannot be independently calculated, and the exact algorithm remains unpublished].
Others may just be challenging to calculate 
due to a lack of tools.  
Some research progress is being made on this, 
however, with 
(for example) 
@Wong:2013aa reporting the development of a 
set of software tools 
that allow many of the TCQSM indicators 
to be calculated from 
General Transit Feed Specification (GTFS) datasets.  
@Wong:2013aa shows results comparing 
50 USA transit operators, 
but has also published 
the code base (on github) 
to allow others to 
undertake similar comparisons in 
other places or at other times.  

While censuses 
and the collection of 
many other datasets 
at local, 
regional and 
national levels 
appear likely to remain 
specific to 
their own geographic contexts, 
there have been some recent 
developments in technology 
and transport 
practices that allow for
universal 
(or at least internationally-applicable) 
tools and approaches. 
The aforementioned GTFS
allows transit 
operators to publish 
their static timetable data 
in an open, 
simple 
and text-based format. 
This was originally developed 
to support the provision of transit 
directions in Google Maps, 
but has since been adopted by 
over 10,000 agencies[@GTFS]. 
Hence, software tools 
that take GTFS data 
as inputs 
can generally be adapted 
easily and rapidly 
to many systems and 
locations. 

One such recently developed 
software tool is the 
*gtfssupplyindex* 
R package [@Reynolds2025gtfsmainpaper],
which builds on 
other GTFS-related R packages 
including 
*gtfstools* [@R-gtfstools]; 
and *tidytransit* [@R-tidytransit]. 
The *gtfssupplyindex* can 
be used to calculate a 
transit Supply Index, 
developed by 
@Currie2003Hobart, 
@Currie2004Gap, 
@Currie2007Identifying 
and @currie2010identifying 
in research related 
to identifying 
gaps in public transport services 
on the basis of social needs for transport. 
This approach, 
and its potential application 
to route and service planning, 
and for policy making 
was suggested to be 
“substantially more useful than the presentation of anecdotal evidence, which is the most common means of identifying transport needs in local transport studies throughout the world”[@currie2010identifying]. 
However, 
its development predated the GTFS, 
and the results presented in 
@currie2010identifying 
for Melbourne, Australia, 
in 2006 
had required 
bespoke cleaning 
and processing 
of data obtained directly 
from the transit agency. 

With the *gtfssupplyindex* 
package, 
however, 
results can be obtained 
directly from GTFS files. 
However, this package 
and approach has yet to be 
applied outside of the 
urban and suburban areas of Melbourne 
(as reported in @Reynolds2025gtfsmainpaper). 
It is unclear whether 
transit Supply Index 
and needs-gap assessment approach can be 
easily applied to other jurisdictions 
or to more rural locations. 
Also unclear is how 
such results might compare 
to other transport-related indicators, 
including those developed 
for rural areas 
(such as the @McHenry:2023aa MI).  


In the following sections, 
therefore, 
this paper 
reports the application 
of the *gtfssupplyindex* 
package to the west of Ireland, 
adopting the same 
case and context as 
@McHenry:2023aa. 
Results from a needs-gap 
analysis are compared to 
those from @McHenry:2023aa 
so as to provide insights 
into the differences 
between these indicators. 
This research is 
anticipated to be 
part of a larger 
programme that 
would continue to 
apply different indicators and approaches 
to this case, 
so as to allow 
deeper understandings 
of both transport in the west of Ireland, 
but also how well 
existing techniques 
might help 
researchers, 
practitioners and policy-makers 
understand and 
improve networks.  

# Methodology

## The transit Supply Index (SI)

@Reynolds2025gtfsmainpaper provide a generalized form of the @currie2010identifying SI equation, which is:

$$SI_{area, time} = \sum_{i=1}^{n}{\frac{Area_{Bi}}{Area_{area}}SL_{i, time}}$$

where:

-   $SI_{area, time}$ is the Supply Index for the *area of interest* and a given period of time;

-   $Area_{Bi}$ is the amount of the buffer zone for each stop (i) that is within the *area of interest*^[In @currie2010identifying this burffer zone was based on a radius of 400 metres for bus and tram stops, and 800 metres for railway stations. The same definition is used here.];

-   $Area_{area}$ is the area of each *area of interest*; and

-   $SL_{i,time}$ is the number of transit arrivals for each stop (i) within the given time period.

Based on the SI scores @currie2010identifying grouped 
areas of interest into seven categories.
The first category includes areas of interest 
with zero SI scores, 
i.e. those areas without 
any transit services at all. 
The remaining areas of interest 
are than categorised into 
three even groups 
(Very Low, Low and Below Average)
across those with 
areas with SI scores below average, 
and three even groups above the average^[Based on only including areas of interest with non-zero scores]
(Above Average, High and Very High). 
This approach, 
which was also used in 
@Reynolds2025gtfsmainpaper, 
has been used in this paper as well 
so as to maintain consistency with the previous research.

The areas of interest adopted 
in this study 
at the 
2022 definition of *Small Areas*, 
used in the 
Irish Census.  



## GTFS data

<!---
Data for this paper was sourced from
@Transit-Mobility-Data:2025aa 
a repository of GTFS feeds. 
The Irish Rail, 
and Transport for Ireland 
feeds^[Dublin Bus, Go Ahead Ireland GTFS and LUAS GTFS] 
that would cover the 
week before the 2022 census^[Held on Sunday April 3[@Central-Statistics-Office:2025aa], with Good Friday 
having fallen on April 15 in that year] 
were used. 



```{r wrangle_ireland_gtfs, eval = FALSE, echo = FALSE}

irish_rail_220328 <- tidytransit::::read_gtfs("data/220403_week_of_census/Irish_Rail_220328.zip")
TFI_Dublin_Bus_220330 <- tidytransit::read_gtfs("data/220403_week_of_census/TFI_Dublin_Bus_220330.zip")
TFI_Go_Ahead_Ireland_220330 <- tidytransit::read_gtfs("data/220403_week_of_census/TFI_Go_Ahead_Ireland_220330.zip")
TFI_LUAC_220316 <- tidytransit::read_gtfs("data/220403_week_of_census/TFI_LUAC_220316.zip")

irish_rail_220328 %>% class()
TFI_Dublin_Bus_220330 %>% class()
TFI_Go_Ahead_Ireland_220330 %>% class()
TFI_LUAC_220316 %>% class()
# all successfully load as tidygtfs class


#irish_rail_220328 <- gtfstools::read_gtfs("data/220403_week_of_census/Irish_Rail_220328.zip")
#TFI_Dublin_Bus_220330 <- gtfstools::read_gtfs("data/220403_week_of_census/TFI_Dublin_Bus_220330.zip")
#TFI_Go_Ahead_Ireland_220330 <- gtfstools::read_gtfs("data/220403_week_of_census/TFI_Go_Ahead_Ireland_220330.zip")
#TFI_LUAC_220316 <- gtfstools::read_gtfs("data/220403_week_of_census/TFI_LUAC_220316.zip")

#irish_rail_220328 %>% class()
#TFI_Dublin_Bus_220330 %>% class()
#TFI_Go_Ahead_Ireland_220330 %>% class()
#TFI_LUAC_220316 %>% class()
# all successfully load as dt_gtfs class

all_feeds_census_week <- list(
  irish_rail_220328,
  TFI_Dublin_Bus_220330,
  TFI_Go_Ahead_Ireland_220330,
  TFI_LUAC_220316
  ) %>% 
  merge_gtfs() 
  
all_feeds_census_week %>% class()

all_feeds_census_week %>% write_gtfs(path = "data/220403_week_of_census/all_feeds_census_week.zip")

```

```{r load_ireland_gtfs_testing, eval = FALSE, echo = FALSE}
all_feeds_census_week <- tidytransit::read_gtfs("data/220403_week_of_census/all_feeds_census_week.zip")

all_feeds_census_week %>% class()

#WELL, that didn't work.  Let's just got with today's feed for now (Oct1, 2025)

```

--->

Data for this paper was sourced from
@Transport-for-Ireland:0aa on October 1, 2025^[Selecting the "All GTFS Operators" feed]. 
The analysis was run for the week starting October 1. 



```{r load_ireland_gtfs, eval = FALSE, echo = FALSE}

## Check feed loads as tidytransit
#TFI_GTFS_All_251001 <- tidytransit::read_gtfs("data/251001/TFI_GTFS_All_251001.zip")
#TFI_GTFS_All_251001 %>% class()
## Yes feed loads successfully

TFI_GTFS_All_251001_list_gtfs <- gtfssupplyindex::gtfs_by_route_type("data/251001/TFI_GTFS_All_251001.zip")

```

```{r load_region_of_interest_function, eval = TRUE, echo = FALSE}

load_region_of_interest <- function(){
region_of_interest <- Small_Area_National_Statistical_Boundaries_2022 %>% 
  filter(COUNTY_ENGLISH == "CLARE" |
           COUNTY_ENGLISH == "DONEGAL" |
           COUNTY_ENGLISH == "GALWAY" |
           COUNTY_ENGLISH == "LEITRIM" |
           COUNTY_ENGLISH == "MAYO" |
           COUNTY_ENGLISH == "ROSCOMMON" |
           COUNTY_ENGLISH == "SLIGO" )
return(region_of_interest)}
```

```{r run_for_all_modes_ireland_, eval = FALSE, echo = FALSE}

list_gtfs = TFI_GTFS_All_251001_list_gtfs


Small_Area_National_Statistical_Boundaries_2022 <- st_read("data/Small_Area_National_Statistical_Boundaries_2022_Ungeneralised_view_-7354763930310470674.gpkg")
st_geometry(Small_Area_National_Statistical_Boundaries_2022) <- "SHAPE"

region_of_interest <- load_region_of_interest()

region_of_interest <- st_set_geometry(region_of_interest, "SHAPE")


#Load region_of_interest codes
areas_of_interest <- load_areas_of_interest(region_of_interest,  
  area_id_field = "SA_PUB2022")

areas_of_interest <- st_set_geometry(areas_of_interest, "geometry")


stops_in_or_near_areas <- gtfssupplyindex:::stops_in_walk_dist(
  list_gtfs = list_gtfs, 
  areas_of_interest = areas_of_interest,
  EPSG_for_transform = 2157,
  verbose = FALSE
)



si_west_ireland_week_251001_by_day_hour_route <- SI_by_day_hour_and_route_type(
     list_gtfs = list_gtfs, 
stops_in_or_near_areas = stops_in_or_near_areas,
 start_date_ymd = "2025-10-01", 
 end_date_ymd = "2025-10-07",
verbose = TRUE)

write.csv(si_west_ireland_week_251001_by_day_hour_route, "results/si_west_ireland_week_251001_by_day_hour_route.csv")


si_west_ireland_week_251001_aggregated <- si_west_ireland_week_251001_by_day_hour_route %>% 
           group_by(area_id) %>%    
           summarize(SI = sum(SI))

write.csv(si_west_ireland_week_251001_aggregated, "results/si_west_ireland_week_251001_aggregated.csv")


```


# Results

## West of Ireland


```{r threshold_function, fig.show="hold", out.width="100%", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE,  cache=FALSE, results='hide'}

## FUNCTION to define thresholds and return Very High, High etc. 
# as per Currie2010 Table 3 and page 34. 
# the approach appears to be to first identify zones that have zero supply 
# the remainder are then split into those above and below the average SI value
# these two groups are then each split into three groups of roughly equal size. 
set_thresholds <-function(si_by_area_dataframe){ 

## Define Very High, High etc thresholds
cuts_lower_groups <- si_by_area_dataframe %>% 
  st_drop_geometry() %>% 
  filter(SI !=0) %>%
  filter(SI <= SI %>% mean()) %>% 
  select(SI) %>% unlist() %>% 
  as.vector() %>% 
  quantileCut(3)

cuts_upper_groups <- si_by_area_dataframe %>% 
  st_drop_geometry() %>% 
  filter(SI !=0) %>%
  filter(SI > SI %>% mean()) %>%
  select(SI) %>% unlist() %>% 
  as.vector() %>% 
  quantileCut(3)

# Recode lower_group factors
allocation_lower_groups <- cuts_lower_groups %>% fct_recode(
  "Very Low" = levels(cuts_lower_groups)[1], 
  "Low" = levels(cuts_lower_groups)[2], 
  "Below average" = levels(cuts_lower_groups)[3])

# Recode upper_group factors
allocation_upper_groups <- cuts_upper_groups %>% fct_recode(
  "Above average" = levels(cuts_upper_groups)[1], 
  "High" = levels(cuts_upper_groups)[2], 
  "Very High" = levels(cuts_upper_groups)[3])


# Join back to lower_group SIs and areas_of_interest
si_by_area_dataframe_below_average <- si_by_area_dataframe %>% 
  st_drop_geometry() %>% 
  filter(SI !=0) %>%
  filter(SI <= SI %>% mean()) 
si_by_area_dataframe_below_average$transit_supply <- allocation_lower_groups

# Join back to upper_group SIs and areas_of_interest
si_by_area_dataframe_above_average <- si_by_area_dataframe %>% 
  st_drop_geometry() %>% 
  filter(SI !=0) %>%
  filter(SI > SI %>% mean()) 
si_by_area_dataframe_above_average$transit_supply <- allocation_upper_groups

# combine upper and lower groups
  
si_by_area_dataframe_non_zero <- add_row(si_by_area_dataframe_below_average, 
                                         si_by_area_dataframe_above_average)

#join back to dataframe, and put "Zero" in N/A
si_by_area_dataframe <- full_join(
  si_by_area_dataframe %>% 
    st_drop_geometry(), 
  si_by_area_dataframe_non_zero
)

si_by_area_dataframe$transit_supply <- si_by_area_dataframe$transit_supply %>% 
  fct_explicit_na(na_level = "Zero Supply") %>% 
  fct_shift(n = -1)

#return dataframe and information about level cut offs
si_by_area_dataframe_and_cuts_dataframe <- list(
  si_by_area_dataframe,
  c(levels(cuts_lower_groups), levels(cuts_upper_groups))
  )
return(si_by_area_dataframe_and_cuts_dataframe)
}
# END FUNCTION

## FUNCTION to set thresholds and return tibble, plot output and thresholds
si_thresholds_and_plot_function <- function(si_by_area, areas_of_interest){
# Set column names
names(si_by_area) <- c("area_id", "SI")
names(areas_of_interest) <- c("area_id", "geometry")
  
si_by_area$area_id <- si_by_area$area_id %>% 
  as.character()


##Join to areas_of_interest so as to identify (and enumerate as zero) 
# those areas of interest that have no SI score 

si_by_area <- full_join(
  areas_of_interest,
  si_by_area)
si_by_area[is.na(si_by_area)] <- 0

si_by_area_thresholds <- set_thresholds(si_by_area_dataframe = si_by_area)
si_by_area <- si_by_area_thresholds[[1]]


si_by_area <- left_join(
  areas_of_interest, 
  si_by_area)

output_plot <- ggplot()+ 
  geom_sf(data=si_by_area %>% na.omit(),
          aes(fill = transit_supply), colour=NA) +
  theme(axis.text.x=element_blank(), #remove x axis labels
        axis.ticks.x=element_blank(), #remove x axis ticks
        axis.text.y=element_blank(),  #remove y axis labels
        axis.ticks.y=element_blank(), #remove y axis ticks
        legend.position="none",
#        legend.text = element_text(size = 4), 
#        legend.title = element_text(size = 5), 
#        legend.key.size = unit(0.08, 'cm')
        ) + 
  scale_fill_manual(values = c("white", "#F9D8B1", "#F7C387", "#F29C33", "lightgreen", "#53A212", "darkgreen")) 


  outputs <- list("si_by_area" = si_by_area, 
                  "output_plot" = output_plot, 
                  "thresholds" = si_by_area_thresholds[[2]])
  return(outputs)
}

```

```{r region_of_interest_2025, fig.show="hold", out.width="100%", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE,  cache=FALSE, results='hide'}

### Load 2025 results
si_by_area <- read.csv("results/si_west_ireland_week_251001_aggregated.csv") %>% 
  as_tibble()
si_by_area <- si_by_area[,2:3]


#Load region_of_interest codes


Small_Area_National_Statistical_Boundaries_2022 <- st_read("data/Small_Area_National_Statistical_Boundaries_2022_Ungeneralised_view_-7354763930310470674.gpkg")
st_geometry(Small_Area_National_Statistical_Boundaries_2022) <- "SHAPE"


#run load_region_of_interest function

region_of_interest <- load_region_of_interest()


region_of_interest <- region_of_interest %>%
  select(SA_GUID_2022, SA_PUB2022, SA_URBAN_AREA_NAME, SA_NUTS2_NAME, SA_NUTS3_NAME, COUNTY_ENGLISH)

names(region_of_interest) <- c("SA_GUID_2022", "SA_PUB2022", "SA_URBAN_AREA_NAME", "SA_NUTS2_NAME", "SA_NUTS3_NAME", "COUNTY_ENGLISH", "geometry" )
region_of_interest <- region_of_interest %>% st_set_geometry("geometry")

#Load region_of_interest codes
areas_of_interest <- load_areas_of_interest(region_of_interest,  
  area_id_field = "SA_PUB2022")

si_region_of_interest_aggregated <- si_thresholds_and_plot_function(si_by_area, areas_of_interest)

## Connect SI results to area definitions
si_region_of_interest_aggregated$si_by_area <- left_join(
  si_region_of_interest_aggregated$si_by_area,
  region_of_interest %>% st_drop_geometry(), 
  by=join_by("area_id" == "SA_PUB2022"))


## Import population data
## T1_1AGETT is total population field.  
# GUID is identification field
SAPS_2022_Small_Area_UR_171024 <- read_csv("data/SAPS_2022_Small_Area_UR_171024.csv") %>% select(GUID, T1_1AGETT) 

names(SAPS_2022_Small_Area_UR_171024) <- c("GUID", "population")

si_region_of_interest_aggregated$si_by_area <- left_join(
  si_region_of_interest_aggregated$si_by_area,
  SAPS_2022_Small_Area_UR_171024, 
  by=join_by("SA_GUID_2022" == "GUID"))

# Categorise population into Very High, High groups etc.
region_of_interest_population <- si_region_of_interest_aggregated$si_by_area %>% 
  st_drop_geometry() %>% 
  select(area_id, population)
names(region_of_interest_population) <- c("area_id", "SI")
region_of_interest_population <- set_thresholds(region_of_interest_population)
names(region_of_interest_population[[1]]) <- c("area_id", "population", "population_category")

si_region_of_interest_aggregated$si_by_area$population_category <- 
  region_of_interest_population[[1]]$population_category

si_region_of_interest_aggregated$si_by_area$population_category <- 
  si_region_of_interest_aggregated$si_by_area$population_category %>%
  factor(levels=c("Very Low", "Low", "Below average", "Above average", "High", "Very High"))

#Calculate population density
si_region_of_interest_aggregated$si_by_area$population_density <- 
  si_region_of_interest_aggregated$si_by_area$population %>% st_drop_geometry() /
  si_region_of_interest_aggregated$si_by_area %>% st_area()
#Categorise population density  
region_of_interest_population_density <- si_region_of_interest_aggregated$si_by_area %>% 
  st_drop_geometry() %>% 
  select(area_id, population_density)
names(region_of_interest_population_density) <- c("area_id", "SI")
region_of_interest_population_density$SI <- region_of_interest_population_density$SI %>%
  as.numeric()
  
region_of_interest_population_density <- set_thresholds(region_of_interest_population_density)
names(region_of_interest_population_density[[1]]) <- c("area_id", "population_density", "density_category")

si_region_of_interest_aggregated$si_by_area$density_category <- 
  region_of_interest_population_density[[1]]$density_category

si_region_of_interest_aggregated$si_by_area$density_category <- 
  si_region_of_interest_aggregated$si_by_area$density_category %>%
  factor(levels=c("Very Low", "Low", "Below average", "Above average", "High", "Very High"))


si_region_of_interest_aggregated$si_by_area$population_density <-  si_region_of_interest_aggregated$si_by_area$population_density %>% as.numeric()

```



```{r SI_map_region_of_interest_county_population, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.margin = TRUE, fig.cap="Transit Supply across west of Ireland, by population"}


#Set boundings box
bbox_list <- region_of_interest %>% 
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric(), bbox_list["xmax"] %>% as.numeric() + 0*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()))

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()

pcol_si_region_of_interest <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "All west of Ireland (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.5),
    axis.text.y = element_text(size = 1.5, hjust = 1),
    axis.text.x = element_blank()
  ) 

pcol_si_region_of_interest_blank <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "All west of Ireland (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.5),
    axis.text.y = element_blank(),
    axis.text.x = element_blank()
  ) 




```


```{r SI_map_region_of_interest_county_clare, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.margin = TRUE, fig.cap="Transit Supply across west of Ireland, by population"}


#Set boundings box
bbox_list <- region_of_interest %>% 
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric(), bbox_list["xmax"] %>% as.numeric() + 0*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()))

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()

pcol_si_county_clare <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>% 
  filter(COUNTY_ENGLISH == "CLARE") %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "County Clare (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.0),
    axis.text.y = element_blank(),
    axis.text.x = element_blank()
  ) 

```


```{r SI_map_region_of_interest_county_galway, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.margin = TRUE, fig.cap="Transit Supply across west of Ireland, by population"}


#Set boundings box
bbox_list <- region_of_interest %>% 
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric(), bbox_list["xmax"] %>% as.numeric() + 0*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()))

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()

pcol_si_county_galway <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>% 
  filter(COUNTY_ENGLISH == "GALWAY") %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "County Galway (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.0),
    axis.text.y = element_blank(),
    axis.text.x = element_blank()
  ) 

```


```{r SI_map_region_of_interest_county_leitrim, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.margin = TRUE, fig.cap="Transit Supply across west of Ireland, by population"}


#Set boundings box
bbox_list <- region_of_interest %>% 
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric(), bbox_list["xmax"] %>% as.numeric() + 0*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()))

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()

pcol_si_county_leitrim <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>% 
  filter(COUNTY_ENGLISH == "LEITRIM") %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "County Leitrim (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.0),
    axis.text.y = element_blank(),
    axis.text.x = element_blank()
  ) 

```


```{r SI_map_region_of_interest_county_mayo, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.margin = TRUE, fig.cap="Transit Supply across west of Ireland, by population"}


#Set boundings box
bbox_list <- region_of_interest %>% 
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric(), bbox_list["xmax"] %>% as.numeric() + 0*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()))

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()

pcol_si_county_mayo <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>% 
  filter(COUNTY_ENGLISH == "MAYO") %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "County Mayo (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.0),
    axis.text.y = element_blank(),
    axis.text.x = element_blank()
  ) 

```


```{r SI_map_region_of_interest_county_roscommon, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.margin = TRUE, fig.cap="Transit Supply across west of Ireland, by population"}


#Set boundings box
bbox_list <- region_of_interest %>% 
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric(), bbox_list["xmax"] %>% as.numeric() + 0*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()))

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()

pcol_si_county_roscommon <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>% 
  filter(COUNTY_ENGLISH == "ROSCOMMON") %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "County Roscommon (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.0),
    axis.text.y = element_blank(),
    axis.text.x = element_blank()
  ) 

```


```{r SI_map_region_of_interest_county_sligo, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.margin = TRUE, fig.cap="Transit Supply across west of Ireland, by population"}


#Set boundings box
bbox_list <- region_of_interest %>% 
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric(), bbox_list["xmax"] %>% as.numeric() + 0*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()))

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()

pcol_si_county_sligo <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>% 
  filter(COUNTY_ENGLISH == "SLIGO") %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "County Sligo (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.0),
    axis.text.y = element_blank(),
    axis.text.x = element_blank()
  ) 

```


```{r SI_map_region_of_interest_county_donegal, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.margin = TRUE, fig.cap="Transit Supply across west of Ireland, by population"}


#Set boundings box
bbox_list <- region_of_interest %>% 
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric(), bbox_list["xmax"] %>% as.numeric() + 0*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()))

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()

pcol_si_county_donegal <- si_region_of_interest_aggregated$si_by_area %>%
  st_drop_geometry() %>% 
  filter(COUNTY_ENGLISH == "DONEGAL") %>%
  aggregate(population ~ transit_supply, sum) %>%
  right_join(tibble(transit_supply = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  replace_na(list(population = 0)) %>%
  mutate(transit_supply=factor(transit_supply, levels = si_region_of_interest_aggregated$si_by_area$transit_supply %>% levels())) %>%
  arrange(transit_supply) %>%
  mutate(perc=population/sum(population)) %>% 
  na.omit() %>%
  ggplot() + 
  geom_col(aes(transit_supply, population, fill = transit_supply), colour="black", size=0.2) +
  scale_y_continuous(limits = c(0,500000)) +
  geom_hline(yintercept = 0)  + 
  geom_text(aes(transit_supply,  population+80000, label = glue::glue("{label_comma(accuracy = 1, big.mark = ",")(population)} ({label_percent(accuracy = 1)(perc)})")), size = 0.75) +
   coord_flip() + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
  scale_color_manual(values = c(rep("black", 5), rep("white", 2), "black")) +
  guides(fill = "none", color = "none") +
  labs(
    title = "County Donegal (by pop.)",
    x = NULL,
    y = NULL
  ) +
  theme_void() +
  theme(
    panel.grid = element_blank(),
    plot.title = element_text(size = 2.0),
    axis.text.y = element_blank(),
    axis.text.x = element_blank()
  ) 

```



```{r county_boundaries, fig.show="hold", eval = FALSE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.fullwidth = TRUE, ncol = 1, out.width="100%", fig.cap="Transit Supply Index categories across the west of Ireland, by Small Area and by population"}

county_boundaries <- region_of_interest  %>% 
    group_by(COUNTY_ENGLISH) %>%
    summarise(geometry = sf::st_union(geometry)) %>%
    ungroup()

st_write(county_boundaries, "data/west_ireland_county_boundaries.shp")

```

```{r load_county_boundaries, fig.show="hold", eval = TRUE, include = FALSE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.fullwidth = TRUE, ncol = 1, out.width="100%", fig.cap="Transit Supply Index categories across the west of Ireland, by Small Area and by population"}

county_boundaries <- st_read("data/west_ireland_county_boundaries.shp")

```


```{r SI_map_region_of_interest_county, fig.show="hold", eval = TRUE, echo = FALSE, warning=FALSE, message=FALSE, cache=FALSE, fig.fullwidth = TRUE, ncol = 1, out.width="100%", fig.cap="Transit Supply Index categories across the west of Ireland, by Small Area and by population"}

#Set boundings box
bbox_list <- region_of_interest %>%
  st_geometry %>% 
  st_combine() %>%
  st_bbox()


lat = c(bbox_list["ymin"] %>% as.numeric(), bbox_list["ymax"] %>% as.numeric())
lon = c(bbox_list["xmin"] %>% as.numeric() - 0.2*(bbox_list["xmax"] %>% as.numeric() - bbox_list["xmin"] %>% as.numeric()), bbox_list["xmax"] %>% as.numeric() )

Poly_Coord_df = data.frame(lon, lat)

poly <- Poly_Coord_df %>% 
  st_as_sf(coords = c("lon", "lat"), 
           crs = 2157) %>% 
  st_bbox() %>% 
  st_as_sfc()


county_region_of_interest_map <- ggplot()+ 
  geom_sf(data=si_region_of_interest_aggregated$si_by_area,
          aes(fill = transit_supply), colour=NA) +
  theme(axis.text.x=element_blank(), #remove x axis labels
        axis.ticks.x=element_blank(), #remove x axis ticks
        axis.text.y=element_blank(),  #remove y axis labels
        axis.ticks.y=element_blank(), #remove y axis ticks
        legend.position="none",
#        legend.text = element_text(size = 4), 
#        legend.title = element_text(size = 5), 
#        legend.key.size = unit(0.08, 'cm')
        ) + 
scale_fill_manual(values = c("Zero Supply" = "white", "Very Low" = "#F9D8B1", "Low" = "#F7C387", "Below average" = "#F29C33", "Above average" = "lightgreen", "High" = "#53A212", "Very High" = "darkgreen")) +
    coord_sf(xlim = c(lon[1],lon[2]), 
           ylim = c(lat[1], lat[2])) +  
  ggspatial::annotation_north_arrow(location = 'tr', height = unit(0.1, "cm"), width = unit(0.3, "cm")) + 
  ggspatial::annotation_scale(location = 'br', height = (unit(0.05, "cm")), text_cex = 0.25) 

county_region_of_interest_map + 
  geom_sf(data=county_boundaries, fill = NA, linewidth = 0.05) +
  inset_element(pcol_si_region_of_interest, left = 0.0, bottom = 0.8, right = 0.60, top =1.0) + 
#  inset_element(pcol_si_region_of_interest_blank, left = 0.105, bottom = 0.6, right = 0.60, top =0.8) + 
  inset_element(pcol_si_county_clare, left = 0.005, bottom = 0.0, right = 0.50, top =0.15) + 
  inset_element(pcol_si_county_donegal, left = 0.75, bottom = 0.6, right = 1.245, top =0.75) + 
  inset_element(pcol_si_county_galway, left = 0.005, bottom = 0.15, right = 0.50, top =0.3) + 
  inset_element(pcol_si_county_leitrim, left = 0.75, bottom = 0.35, right = 1.245, top =0.50) + 
  inset_element(pcol_si_county_mayo, left = 0.105, bottom = 0.65, right = 0.60, top =0.8) + 
  inset_element(pcol_si_county_roscommon, left = 0.750, bottom = 0.2, right = 1.245, top =0.35) + 
  inset_element(pcol_si_county_sligo, left = 0.325, bottom = 0.6, right = 0.82, top =0.75) 

```
Figure \ref{fig:SI_map_region_of_interest_county} shows transit Supply Index (SI) categories by Small Areas across the west of Ireland. It also shows to the
population living in Small Areas in each category for both the entire west of Ireland and for each county. 


